version: '3.1'

services:
  cd-worker:
    build:
      context: .
      dockerfile: worker.Dockerfile
    environment:
      ENV: DEV
      PORT: 8000
      SQLLINK_USERS_DATA: ${SQLLINK_USERS_DATA}
      SQLLINK_CODON: ${SQLLINK_CODON}
      SQLLINK_CODON_HEALTH: ${SQLLINK_CODON_HEALTH}
      SQLLINK_USERS: ${SQLLINK_USERS}
      WORKER_SLEEP_TIME: ${WORKER_SLEEP_TIME}
    volumes:
      - ./worker:/worker
    restart: always
    links:
      - db-users
    depends_on:
      - db-users
    container_name: cd-worker

  # db-codon:
  #   image: mysql:latest
  #   command: --default-authentication-plugin=mysql_native_password
  #   restart: always
  #   volumes: 
  #     - ./db/mysql:/var/lib/mysql
  #   environment:
  #     MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
  #   container_name: cd-db-codon

  db-users:
    image: mysql:latest
    command: --default-authentication-plugin=mysql_native_password
    restart: always
    volumes: 
      - ./db/mysql_users:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_USERS_ROOT_PASSWORD}
    container_name: cd-db-users

  # myadmin:
  #   image: phpmyadmin/phpmyadmin
  #   restart: always
  #   links: 
  #     - db
  #   ports:
  #     - 8086:80

  # myadmin_users:
  #   image: phpmyadmin/phpmyadmin
  #   restart: always
  #   links: 
  #     - db-users
  #   environment:
  #     PMA_HOST: db-users
  #   ports:
  #     - 8087:80